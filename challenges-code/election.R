#| title: "Australian Election Greens Vote Share"
#| dataset-name: "election_greens, ozmaps::abs_ced"
#| description: "Visualising Australian election data is a challenge - Australia is a large country with lots of small regions. In this challenge, you will need two datasets to draw the beeswarm and the map that shows the election percentage of the Australian Greens party."
#| colours: "`scale_fill_viridis_c()`"
#| prerun-code: "set.seed(3456)"

library(ggplot2)
library(forcats)
library(ozmaps)
library(rmapshaper)
library(ggbeeswarm)
library(patchwork)
library(dplyr)

election_greens <- structure(list(DivisionID = c("101", "102", "103", "104", "105", 
"106", "107", "108", "109", "111", "112", "113", "114", "115", 
"117", "118", "119", "120", "121", "122", "124", "125", "126", 
"127", "128", "130", "131", "132", "133", "134", "135", "136", 
"137", "138", "139", "140", "144", "145", "146", "148", "149", 
"150", "151", "152", "153", "155", "156", "157", "158", "159", 
"160", "161", "162", "163", "164", "165", "166", "167", "168", 
"169", "170", "171", "172", "173", "174", "175", "176", "177", 
"178", "179", "180", "182", "183", "185", "186", "187", "188", 
"190", "192", "193", "195", "196", "197", "198", "200", "201", 
"203", "204", "205", "207", "208", "209", "210", "211", "212", 
"213", "214", "215", "216", "217", "218", "219", "220", "221", 
"222", "223", "224", "225", "226", "228", "229", "232", "233", 
"234", "235", "236", "237", "238", "239", "240", "242", "243", 
"244", "245", "246", "247", "248", "249", "250", "251", "252", 
"302", "304", "305", "306", "307", "309", "310", "311", "312", 
"315", "316", "317", "318", "319", "320", "321", "322", "323", 
"324", "325"), DivisionNm = c("Canberra", "Fenner", "Banks", 
"Barton", "Bennelong", "Berowra", "Blaxland", "Bradfield", "Calare", 
"Chifley", "Cook", "Cowper", "Cunningham", "Dobell", "Eden-Monaro", 
"Farrer", "Fowler", "Gilmore", "Grayndler", "Greenway", "Hughes", 
"Hume", "Hunter", "Kingsford Smith", "Lindsay", "Lyne", "Macarthur", 
"Mackellar", "Macquarie", "Mitchell", "New England", "Newcastle", 
"North Sydney", "Page", "Parkes", "Parramatta", "Reid", "Richmond", 
"Robertson", "Shortland", "Sydney", "Whitlam", "Warringah", "Wentworth", 
"Werriwa", "Bowman", "Brisbane", "Capricornia", "Dawson", "Fadden", 
"Fairfax", "Fisher", "Forde", "Griffith", "Groom", "Herbert", 
"Hinkler", "Kennedy", "Leichhardt", "Lilley", "Maranoa", "McPherson", 
"Moncrieff", "Moreton", "Oxley", "Petrie", "Rankin", "Ryan", 
"Wide Bay", "Adelaide", "Barker", "Boothby", "Grey", "Hindmarsh", 
"Kingston", "Makin", "Mayo", "Sturt", "Bass", "Braddon", "Franklin", 
"Lyons", "Aston", "Ballarat", "Bendigo", "Bruce", "Calwell", 
"Casey", "Chisholm", "Corangamite", "Corio", "Deakin", "Dunkley", 
"Flinders", "Gellibrand", "Gippsland", "Goldstein", "Higgins", 
"Holt", "Hotham", "Indi", "Isaacs", "Jagajaga", "Kooyong", "Lalor", 
"La Trobe", "Mallee", "Maribyrnong", "McEwen", "Melbourne", "Menzies", 
"Scullin", "Wannon", "Wills", "Brand", "Canning", "Cowan", "Curtin", 
"Forrest", "Fremantle", "Moore", "O'Connor", "Pearce", "Perth", 
"Stirling", "Swan", "Tangney", "Paterson", "Riverina", "Watson", 
"Dickson", "Longman", "Blair", "Hasluck", "Lingiari", "Solomon", 
"Gorton", "Bonner", "Flynn", "Durack", "McMahon", "Wright", "Burt", 
"Bean", "Clark", "Cooper", "Fraser", "Macnamara", "Monash", "Nicholls", 
"Spence"), State = c("ACT", "ACT", "NSW", "NSW", "NSW", "NSW", 
"NSW", "NSW", "NSW", "NSW", "NSW", "NSW", "NSW", "NSW", "NSW", 
"NSW", "NSW", "NSW", "NSW", "NSW", "NSW", "NSW", "NSW", "NSW", 
"NSW", "NSW", "NSW", "NSW", "NSW", "NSW", "NSW", "NSW", "NSW", 
"NSW", "NSW", "NSW", "NSW", "NSW", "NSW", "NSW", "NSW", "NSW", 
"NSW", "NSW", "NSW", "QLD", "QLD", "QLD", "QLD", "QLD", "QLD", 
"QLD", "QLD", "QLD", "QLD", "QLD", "QLD", "QLD", "QLD", "QLD", 
"QLD", "QLD", "QLD", "QLD", "QLD", "QLD", "QLD", "QLD", "QLD", 
"SA", "SA", "SA", "SA", "SA", "SA", "SA", "SA", "SA", "TAS", 
"TAS", "TAS", "TAS", "VIC", "VIC", "VIC", "VIC", "VIC", "VIC", 
"VIC", "VIC", "VIC", "VIC", "VIC", "VIC", "VIC", "VIC", "VIC", 
"VIC", "VIC", "VIC", "VIC", "VIC", "VIC", "VIC", "VIC", "VIC", 
"VIC", "VIC", "VIC", "VIC", "VIC", "VIC", "VIC", "VIC", "WA", 
"WA", "WA", "WA", "WA", "WA", "WA", "WA", "WA", "WA", "WA", "WA", 
"WA", "NSW", "NSW", "NSW", "QLD", "QLD", "QLD", "WA", "NT", "NT", 
"VIC", "QLD", "QLD", "WA", "NSW", "QLD", "WA", "ACT", "TAS", 
"VIC", "VIC", "VIC", "VIC", "VIC", "SA"), votes_GRN = c(20144, 
12492, 5339, 8123, 9116, 11157, 4329, 13177, 6315, 4604, 6406, 
6264, 15196, 7579, 8715, 4529, 4633, 10740, 21607, 5256, 6631, 
5224, 7007, 11418, 4781, 6589, 4397, 11283, 8870, 7955, 4311, 
16038, 13193, 12634, 3921, 6131, 7575, 20384, 7601, 8256, 17134, 
9461, 5647, 6759, 5060, 11795, 22807, 4307, 4009, 8747, 12291, 
12289, 7987, 23562, 7598, 6721, 3422, 4751, 9340, 13539, 3177, 
10167, 8900, 15189, 10535, 8877, 7709, 19621, 9330, 16853, 7229, 
13224, 4760, 11966, 9764, 9211, 10436, 12263, 7202, 3384, 11420, 
6765, 8867, 9077, 11381, 6801, 5893, 10919, 11235, 9184, 12902, 
8730, 8125, 6599, 16303, 5835, 13951, 22573, 6735, 8722, 4255, 
10822, 13929, 21035, 7273, 7752, 3297, 14943, 8026, 45876, 10264, 
6128, 6590, 25575, 9863, 6840, 8551, 13847, 11645, 14574, 10735, 
7245, 8676, 16552, 10439, 10367, 9319, 7439, 6254, 5982, 9675, 
6684, 8325, 9651, 3991, 6521, 6730, 11010, 2744, 6287, 4218, 
6951, 8285, 12168, 6458, 20605, 7645, 23534, 7047, 4011, 7330
), votes_total = c(88307, 89302, 98845, 99380, 101542, 100370, 
93209, 100199, 110539, 100734, 100164, 114426, 106757, 107892, 
106505, 107017, 96288, 113647, 100072, 102432, 100699, 109522, 
112075, 100181, 109538, 111276, 109167, 103119, 101289, 103870, 
104440, 109081, 100913, 113548, 99799, 92409, 99847, 108381, 
103554, 106827, 98569, 110691, 97020, 92525, 106553, 101804, 
104588, 94975, 95550, 102231, 104355, 104040, 95983, 101919, 
98608, 97676, 99877, 95944, 95945, 100085, 96573, 98771, 98246, 
93441, 95039, 105410, 91975, 98795, 98539, 111299, 111893, 116030, 
111131, 113879, 110628, 111725, 116216, 115953, 71973, 75303, 
72545, 74991, 103919, 107372, 105979, 98561, 96336, 106720, 99383, 
105816, 102400, 101424, 102078, 103076, 102113, 101998, 101580, 
102541, 98756, 99648, 105557, 101017, 100936, 102062, 97815, 
103305, 105619, 103938, 101462, 95960, 101702, 96864, 108050, 
100333, 94769, 96782, 89703, 91989, 95880, 96302, 93527, 91742, 
107414, 91926, 91038, 89333, 87250, 114513, 106430, 96409, 101364, 
105722, 103690, 89099, 51009, 57602, 100598, 97027, 94974, 81613, 
97124, 103162, 94082, 97982, 69150, 102467, 98605, 101380, 105117, 
102971, 108096), perc_GRN = c(22.8113286602421, 13.9884884996977, 
5.40138600839698, 8.17367679613604, 8.97756593330838, 11.1158712762778, 
4.64440129172076, 13.1508298486013, 5.71291580347208, 4.57045287589096, 
6.39551136136736, 5.47428032090609, 14.2341954157573, 7.02461720980239, 
8.18271442655274, 4.23203790052048, 4.81160684612828, 9.45031545047384, 
21.5914541530098, 5.13120899718838, 6.58497105234411, 4.76981793612242, 
6.25206335043498, 11.3973707589263, 4.36469535686246, 5.92131277184658, 
4.02777396099554, 10.941727518692, 8.75712071399658, 7.65861172619621, 
4.12772883952509, 14.7028355075586, 13.0736376879094, 11.1265720224046, 
3.9288970831371, 6.63463515458451, 7.58660750948952, 18.8077246011755, 
7.3401317187168, 7.72838327389143, 17.3827471111607, 8.54721702758128, 
5.82044939187796, 7.30505268846258, 4.74881045113699, 11.5859887627205, 
21.8065170000382, 4.53487759936825, 4.19570905285191, 8.5561131163737, 
11.7780652580135, 11.8118031526336, 8.32126522405009, 23.118358696612, 
7.70525717994483, 6.88091240427536, 3.42621424351953, 4.95184691069791, 
9.7347438636719, 13.5275016236199, 3.28973936814638, 10.2935072035314, 
9.05889298292042, 16.2551770636016, 11.0849230315976, 8.42140214400911, 
8.38162544169611, 19.8603168176527, 9.46833233542049, 15.1420947178321, 
6.46063650094287, 11.3970524864259, 4.28323330123908, 10.5076440783639, 
8.82597534078172, 8.24434996643544, 8.97983066015006, 10.5758367614464, 
10.0065302266128, 4.49384486673838, 15.7419532703839, 9.02108252990359, 
8.53260712670445, 8.4537868345565, 10.738919974712, 6.90029524862775, 
6.11713170569673, 10.2314467766117, 11.3047503094091, 8.67921675361004, 
12.599609375, 8.60743019403692, 7.95959952193421, 6.4020722573635, 
15.9656459020889, 5.72070040589031, 13.7340027564481, 22.0136335709619, 
6.81983879460488, 8.75280989081567, 4.03099747056093, 10.7130482988012, 
13.7998335578981, 20.6100213595658, 7.43546490824516, 7.50399303034703, 
3.12159743985457, 14.3768400392542, 7.91035067315842, 47.8074197582326, 
10.0922302412932, 6.32639577139082, 6.09902822767237, 25.4901179073685, 
10.4074117063597, 7.06742989398855, 9.5325685874497, 15.0528867581993, 
12.145390070922, 15.1336420842765, 11.4779689287585, 7.89714634518541, 
8.07715940194016, 18.0057872636686, 11.4666403040489, 11.6048940481121, 
10.6808022922636, 6.49620567097186, 5.87616273607066, 6.20481490317294, 
9.54480880786078, 6.32224134995554, 8.02873951200694, 10.8317714003524, 
7.82410947087769, 11.3207874726572, 6.6899938368556, 11.3473569212693, 
2.8892117842778, 7.70342960067636, 4.34290185741938, 6.73794614295962, 
8.80614782849004, 12.4186074993366, 9.33911785972523, 20.1089131134902, 
7.75315653364434, 23.2136516078122, 6.70395844630269, 3.89527148420429, 
6.78100947306098)), row.names = c(NA, -151L), class = c("tbl_df", 
"tbl", "data.frame"))

beeswarm <- election_greens |>
  mutate(State = fct_reorder(State, perc_GRN)) |>
  ggplot(aes(x=perc_GRN, y=State)) +
    geom_quasirandom(groupOnX = FALSE, varwidth = TRUE, size = 0.1) +
    labs(
      x = "First preference votes %",
      y = ""
    ) +
  xlim(c(0,50)) +
  theme_bw() +
  theme(text = element_text(size = 8))


oz_states <- ozmaps::ozmap_states |> filter(NAME != "Other Territories")
oz_votes_grn <- full_join(ozmaps::abs_ced, election_greens, by=c("NAME"="DivisionNm"))


map <- ggplot(oz_votes_grn, aes(fill=perc_GRN)) +
  geom_sf(colour="white") +
  scale_fill_viridis_c(direction=-1, trans = "log", 
    guide = "colourbar", 
    labels = scales::label_number(accuracy = 0.1)) +
  theme_void() +
  theme(legend.position = "right", 
    legend.title = element_blank(), text = element_text(size = 8))

p <- beeswarm + map

print(p)